# TCL脚本综合流程指南

## 1. 概述

本文件旨在详细介绍 `tcl/` 目录下的TCL (Tool Command Language) 脚本集。这些脚本共同构成了一个自动化的**逻辑综合（Logic Synthesis）**流程，是数字集成电路（ASIC）设计流程中的关键环节。

**核心目标**: 将项目 `ourwork/` 目录中描述电路行为的Verilog RTL代码，在满足特定性能、功耗和面积（PPA）约束的前提下，自动转换为由标准逻辑单元（如与门、或门、触发器）组成的**门级网表（Gate-level Netlist）**。

**目标EDA工具**: 这些脚本是为专业的逻辑综合工具编写的，例如 **Synopsys Design Compiler (DC)** 或 **Cadence Genus**。

## 2. 脚本文件结构与功能

综合流程由一个主控脚本 `top_syn.tcl` 驱动，它会按顺序调用其他辅助脚本来完成特定任务。

### `top_syn.tcl`
-   **主要功能**: **主控脚本**，是整个综合流程的入口点。
-   **详细说明**: 该脚本负责编排整个综合过程。执行它会触发以下一系列动作：
    1.  调用 `set_env.tcl` 来设置所需的技术库和搜索路径。
    2.  调用 `file_create.tcl` 来读取所有的Verilog源文件。
    3.  调用 `constraint_sdc.tcl` 来加载设计的时序和设计规则约束。
    4.  执行核心的综合命令（例如 `compile_ultra`）。
    5.  生成关于时序、面积、功耗等关键指标的报告。
    6.  将最终生成的门级网表和其他结果文件（如新的约束文件）写入到指定的输出目录。

### `set_env.tcl`
-   **主要功能**: **环境设置脚本**。
-   **详细说明**: 负责为综合工具配置工作环境，是所有操作的基础。它主要定义：
    -   **工艺库路径**: 指向包含标准逻辑单元（Standard Cells）信息的库文件（`.db` 或 `.lib`）。这是综合工具进行映射的基础，它告诉工具“你有哪些积木可以用”。
    -   **搜索路径**: 告诉工具去哪里寻找Verilog源文件。
    -   **顶层模块名**: 定义本次综合的目标顶层模块（例如 `top`）。

### `file_create.tcl`
-   **主要功能**: **源文件列表脚本**。
-   **详细说明**: 该脚本的主要任务是定义一个列表，其中包含所有需要被综合的Verilog RTL文件路径，并使用 `read_verilog` 或 `analyze` 命令将它们读入工具内存。

### `constraint_sdc.tcl`
-   **主要功能**: **设计约束脚本** (SDC - Synopsys Design Constraints)。
-   **详细说明**: 这是**流程中最关键的脚本之一**。它为综合工具设定了明确的优化目标。没有这些约束，工具将无法知道设计的性能要求。
    -   `create_clock`: 定义时钟信号的周期、占空比和源点，直接决定了芯片的目标工作频率。
    -   `set_input_delay` / `set_output_delay`: 定义输入/输出端口相对于时钟的延时。
    -   `set_driving_cell` / `set_load`: 模拟芯片外部电路对输入端口的驱动能力和输出端口所连接的负载。
    -   其他设计规则约束，如最大扇出 (`set_max_fanout`) 等。

### `dont_touch.tcl`
-   **主要功能**: **特殊约束脚本**。
-   **详细说明**: 指示综合工具在优化过程中**不要触碰或修改**设计中的某些特定单元或网络。这通常用于：
    -   保护预先布局好的宏单元（如SRAM）。
    -   保持时钟网络的完整性。
    -   防止工具优化掉用于调试的信号。

### `set_parameter.tcl`
-   **主要功能**: **参数配置脚本**。
-   **详细说明**: 用于设置一些影响综合策略的全局参数或覆盖Verilog代码中定义的参数（`parameter`）。

## 3. 如何执行综合流程

要运行此综合流程，请遵循以下步骤：

1.  **准备环境**: 确保已安装逻辑综合EDA工具（如 Design Compiler），并正确配置了license。

2.  **启动工具**: 在Linux终端环境中，启动EDA工具的命令行界面（例如，`dc_shell`）。

3.  **执行主脚本**: 在工具的TCL命令提示符下，使用 `source` 命令执行主控脚本。

    ```tcl
    # 假设当前工作目录是项目的根目录
    # 在EDA工具的TCL命令行中执行：
    source ./tcl/top_syn.tcl
    ```

4.  **查看结果**: 脚本执行完毕后，工具会根据 `top_syn.tcl` 中的设置，在指定的输出目录（通常是 `output/` 或 `syn/`）生成以下文件：
    -   **门级网表**: 例如 `top.g.v` 或 `top.nl.v`。
    -   **报告文件**: 时序报告 (`.timing.rpt`)、面积报告 (`.area.rpt`) 等。
    -   **新的约束文件**: 例如 `top.sdc`。

## 4. 总结

`tcl/` 目录下的脚本集是实现设计自动化、确保设计质量和可重复性的关键。它们将设计者的意图（通过Verilog代码和SDC约束表达）系统地传达给EDA工具，是连接抽象RTL设计与具体物理实现的桥梁。
