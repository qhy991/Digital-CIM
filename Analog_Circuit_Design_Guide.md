# 模拟与定制电路设计工作指南

## 1. 概述

本文件旨在详细介绍 `CIMPQC/` 目录中所包含的**模拟与全定制电路设计**工作。这部分工作是整个CIM-PQC加速器项目的物理基础和性能核心。

**核心目标**: 使用专业的EDA工具（**Cadence Virtuoso**），从最基础的晶体管级别（Transistor-level）开始，手动设计、搭建并优化存算一体（CIM）架构所需的全部底层电路单元。

**设计方法**: 采用**全定制（Full-Custom）设计**方法。与数字流程中用硬件描述语言（Verilog）描述逻辑行为不同，全定制设计关注的是电路的实际电气特性（电压、电流、时序、功耗），通过精细调整晶体管尺寸和版图布局，以实现最优的性能、功耗和面积（PPA）指标。

## 2. 模块功能与设计分析

`CIMPQC/` 目录下的设计层次清晰，体现了自底向上（Bottom-up）的构建方法。

### 基础单元 (Building Blocks)

-   **`8T_cell/`**: **8晶体管SRAM单元**
    -   **功能**: 这是整个设计的**基石**，既是数据存储单元，也是执行存内计算的核心。相较于传统的6T SRAM，8T结构通常分离了读、写路径，使得在执行计算（读操作）时不会破坏存储的数据，极大地提升了稳定性和可靠性。
    -   **重要性**: 该单元的性能直接决定了整个CIM阵列的计算精度、速度和功耗。

-   **`nand_gate/`, `nor_gate/`, `not_gate/`**: **基本逻辑门**
    -   **功能**: 设计与非门、或非门和反相器等基本数字逻辑门。
    -   **为何是定制设计?**: 在这里，这些门电路不是从标准库中直接调用，而是通过手动搭建PMOS和NMOS晶体管实现的。目的是创建一个针对本项目工艺和电压的**私有、高性能标准单元库**，以获得比通用库单元更优的速度和功耗。

### 关键模拟/混合信号电路

-   **`csdrv/`**: **列驱动与感知放大器 (Column Driver & Sense Amplifier)**
    -   **功能**: 这是至关重要的**混合信号模块**。存内计算的结果通常表现为位线（Bit-line）上一个非常微弱的模拟电压或电流变化。**感知放大器**的职责就是精确地检测到这个微弱的模拟信号，将其放大，并最终转换为一个明确的'0'或'1'的数字信号。
    -   **重要性**: 感知放大器的精度、速度和功耗，直接决定了整个CIM宏单元的计算结果是否正确，以及能效比的高低。

### 层次化集成 (Hierarchical Integration)

-   **`cim_row/`**: 将多个 `8T_cell` 在水平方向上连接，形成一个完整的**电路行**。
-   **`cim_array/`**: 将多个 `cim_row` 在垂直方向上堆叠，并集成相应的列电路，形成一个二维的**存算阵列**。这是执行并行计算的主体结构。
-   **`cim_bank/`**: 将多个 `cim_array` 与其共享的周边电路（如地址译码器、读写控制器）组合成一个**存算库**。
-   **`cim_macro/` & `cim_top/`**: 将一个或多个 `cim_bank` 与顶层的电源管理、IO接口等完全集成，形成一个可独立工作的**CIM宏单元**或**整个模拟设计的顶层**。

## 3. 当前设计阶段与后续步骤

从文件结构（大量 `schematic/` 和 `symbol/` 目录）判断，当前工作主要处于**原理图设计（Schematic Entry）**阶段。

-   **原理图 (`schematic/`)**: 定义了电路中所有元器件（晶体管、电阻、电容等）的连接关系。
-   **符号 (`symbol/`)**: 创建一个逻辑符号，用于在更高层级的原理图中例化（调用）该电路。

**后续的标准设计流程包括：**

1.  **电路仿真 (Simulation)**: 使用 **Cadence Spectre** 或类似工具，对原理图进行详尽的仿真，验证其直流、交流、瞬态特性，确保其功能和性能达标。
2.  **版图设计 (Layout)**: 为通过仿真的原理图绘制其对应的物理版图，即定义元器件和连线在硅片上的实际几何图形。
3.  **版图验证 (Verification)**: 运行 **DRC** (设计规则检查) 和 **LVS** (版图-原理图一致性检查)，确保版图符合制造要求且与原理图完全一致。
4.  **寄生参数提取与后仿真 (PEX & Post-layout Simulation)**: 从版图中提取寄生电阻电容，带入仿真模型中进行后仿真，以获得最接近真实芯片的性能数据。

## 4. 总结

模拟电路部分的工作是高度专业和精细的，它为整个CIM-PQC加速器项目提供了高性能的物理实现基础。通过在晶体管级别的全定制优化，这部分工作旨在突破标准数字流程的性能瓶颈，是实现尖端存算一体芯片设计的关键所在。
